{% extends "base.html" %}
{% load static %}
{% load humanize %}

{% block extra_css %}
<!-- Products CSS -->
<link rel="stylesheet" href="{% static 'products/css/products.css' %}">
{% endblock %}

{% block content %}
<!-- Product List -->
<section>
    <div class="container-fluid margin-top">
        <div class="row justify-content-center">
            {% include "products/filter.html" %}
            {% if products %}
            <p class="ps-3">Results: {{ request.GET.q|title }} ({{ products.paginator.count  }} products found)</p>
            {% for product in products %}
            <div
                class="col-lg-2 col-md-3 col-sm-3 col-12 d-flex flex-column align-items-center product-container mb-5 mx-2 py-3">
                <a href="{% url 'product_detail' product.pk %}">
                    <div class="product-card">
                        <div class="product-image-container">
                            <a href="{% url 'product_detail' product.pk %}"><img class="product-img"
                                    src="{{ product.image.url }}" alt="{{ product.title }}"></a>
                        </div>
                        {% for i in "x"|ljust:product.rating %}
                        <i class="fa fa-star fa-xs text-dark"></i>
                        {% endfor %}
                        {% for i in product.rating|add:"-5"|floatformat:"0"|default:"1" %}
                        <i class="fa fa-star-o fa-xs text-dark"></i>
                        {% endfor %}
                    </div>
                    <div class="product-content d-flex flex-column align-items-start">
                        <p class="product-title mb-2"><a
                                href="{% url 'product_detail' product.pk %}">{{product.title}}</a></p>
                        <div class="d-flex flex-column justify-content-end h-100">
                            {% if product.sale %}
                            <p class="product-sale-price price mb-0">{{ product.sale_price|intcomma }}€</p>
                            <p class="strike-price">{{ product.retail_price|intcomma }}€</p>
                            {% else %}
                            <p class="price">{{ product.retail_price|intcomma }}€</p>
                            {% endif %}
                            <div class="d-flex">
                                {% include 'products/components/add_to_cart_qty_1.html' %}
                                <a class="add-wishlist" href="#" aria-label="Add to Wishlist">
                                    <i class="fa-regular fa-heart fa-sm"></i>
                                </a>
                            </div>
                        </div>
                    </div>
            </div>
            {% endfor %}
            {% else %}
            <div class="d-flex flex-column align-items-center no-search-result p-5">
                <p>No search results found for <strong>{{ request.GET.q|title }}.</strong></p>
                <button class="btn btn-cta upper"><a href="{% url 'products' %}">Show all products</a></button>
                {% endif %}
            </div>
        </div>
</section>
<!-- Back to Top Button -->
<button type="button" class="btn btn-floating" id="btn-back-to-top">
    <i class="fas fa-arrow-up"></i>
</button>
<!-- Pagination -->
{% if is_paginated %}
<nav class="mt-auto" aria-label="Page navigation">
    <ul class="pagination pagination-sm justify-content-center">
        {% if page_obj.has_previous %}
        <li class="page-item">
            <a class="page-link text-dark"
                href="?{% if sort_by %}sort_by={{ sort_by }}&{% endif %}{% if selected_category %}category={{ selected_category }}&{% endif %}{% if selected_brand %}brand={{ selected_brand }}&{% endif %}page={{ page_obj.previous_page_number }}"
                aria-label="Previous page"><span aria-hidden="true">←</span></a>
        </li>
        {% else %}
        <li class="page-item disabled"><span class="page-link">←</span></li>
        {% endif %} {% for i in paginator.page_range %} {% if page_obj.number == i %}
        <li class="page-item active" aria-current="page">
            <a class="page-link"
                href="?{% if sort_by %}sort_by={{ sort_by }}&{% endif %}{% if selected_category %}category={{ selected_category }}&{% endif %}{% if selected_brand %}brand={{ selected_brand }}&{% endif %}page={{ i }}"
                aria-label="Current page"><span aria-hidden="true">{{ i }}</span></a>
        </li>
        {% else %}
        <li class="page-item">
            <a class="page-link"
                href="?{% if sort_by %}sort_by={{ sort_by }}&{% endif %}{% if selected_category %}category={{ selected_category }}&{% endif %}{% if selected_brand %}brand={{ selected_brand }}&{% endif %}page={{ i }}"
                aria-label="Page {{ i }}"><span aria-hidden="true">{{ i }}</span></a>
        </li>
        {% endif %} {% endfor %} {% if page_obj.has_next %}
        <li class="page-item">
            <a class="page-link text-dark"
                href="?{% if sort_by %}sort_by={{ sort_by }}&{% endif %}{% if selected_category %}category={{ selected_category }}&{% endif %}{% if selected_brand %}brand={{ selected_brand }}&{% endif %}page={{ page_obj.next_page_number }}"
                aria-label="Next page"><span aria-hidden="true">→</span></a>
        </li>
        {% else %}
        <li class="page-item disabled"><span class="page-link">→</span></li>
        {% endif %}
    </ul>
</nav>
{% endif %}
{% endblock %}

{% block postloadjs %}
<!-- Products JS -->
<script src="{% static 'products/js/back_to_top.js' %}"></script>
<script src="{% static 'products/js/filters.js' %}"></script>
{% endblock %}